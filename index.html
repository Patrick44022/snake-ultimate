
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Patrick’s Snake Ultimate Edition</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      background: linear-gradient(45deg, #a1c4fd, #c2e9fb);
      color: #222;
      overflow: hidden;
    }
    body.dark {
      background: #111;
      color: #eee;
    }
    canvas {
      display: none;
      margin: 0 auto;
      border: 3px solid #333;
      background-color: #fff;
    }
    .btn {
      padding: 10px 20px;
      margin: 10px;
      font-size: 1.2em;
      cursor: pointer;
      border: none;
      border-radius: 8px;
    }
    #menu {
      margin-top: 30px;
    }
    #leaderboard, #achievements {
      margin-top: 20px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 10px;
    }
    #touchControls {
      display: none;
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      gap: 10px;
    }
    .touch-btn {
      width: 60px;
      height: 60px;
      font-size: 1.5em;
    }
  </style>
</head>
<body>
  <h1>Patrick’s Snake Ultimate Edition 🐍</h1>
  <div id="menu">
    <label for="playerName">👤 Name:</label>
    <input type="text" id="playerName" placeholder="Patrick" /><br><br>
    <label for="skinSelect">🎨 Skin:</label>
    <select id="skinSelect">
      <option value="emoji">🐍 Emoji</option>
      <option value="neon">💡 Neon</option>
      <option value="classic">🟩 Classic</option>
      <option value="alien">👾 Alien</option>
      <option value="frog">🐸 Frosch</option>
      <option value="crystal">💎 Crystal</option>
      <option value="fire">🔥 Feuer</option>
      <option value="ice">❄️ Eis</option>
    </select><br><br>
    <button class="btn" onclick="startGame()">▶️ Start</button>
    <button class="btn" onclick="toggleTheme()">🌗 Theme</button>
  </div>

  <p id="info" style="display:none;">
    👤 <span id="currentPlayer"></span> |
    🏆 Score: <span id="score">0</span> |
    ❤️ Lives: <span id="lives">3</span>
  </p>

  <canvas id="game" width="400" height="400"></canvas>

  <div id="leaderboard" style="display:none;">
    <h3>🏆 Leaderboard</h3>
    <ul id="scoreList"></ul>
  </div>

  <div id="achievements" style="display:none;">
    <h3>🎖️ Achievements</h3>
    <ul id="achList"></ul>
  </div>

  <div id="touchControls">
    <button class="btn touch-btn" onclick="setDir('UP')">⬆️</button><br>
    <button class="btn touch-btn" onclick="setDir('LEFT')">⬅️</button>
    <button class="btn touch-btn" onclick="setDir('DOWN')">⬇️</button>
    <button class="btn touch-btn" onclick="setDir('RIGHT')">➡️</button>
  </div>

  <!-- Sounds -->
  <audio id="eat-sound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_36e63c7728.mp3"></audio>
  <audio id="gameover-sound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_5ec6824644.mp3"></audio>
  <audio id="music" src="https://cdn.pixabay.com/audio/2023/03/28/audio_7ab6ce33b6.mp3" loop></audio>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const eatSound = document.getElementById("eat-sound");
    const gameOverSound = document.getElementById("gameover-sound");
    const music = document.getElementById("music");

    let snake, food, direction, score, lives, skin, interval, playerName;
    let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
    let achievements = [];

    if (localStorage.getItem("theme") === "dark") {
      document.body.classList.add("dark");
    }

    function toggleTheme() {
      document.body.classList.toggle("dark");
      localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
    }

    function startGame() {
      playerName = document.getElementById("playerName").value || "Gast";
      document.getElementById("currentPlayer").innerText = playerName;
      skin = document.getElementById("skinSelect").value;
      score = 0;
      lives = 3;
      direction = "RIGHT";
      snake = [{x: 200, y: 200}];
      food = {x: 100, y: 100};
      document.getElementById("score").innerText = score;
      document.getElementById("lives").innerText = lives;
      document.getElementById("menu").style.display = "none";
      document.getElementById("game").style.display = "block";
      document.getElementById("info").style.display = "block";
      document.getElementById("leaderboard").style.display = "none";
      document.getElementById("achievements").style.display = "none";
      document.getElementById("touchControls").style.display = "flex";
      music.volume = 0.2;
      music.play().catch(()=>{});
      clearInterval(interval);
      interval = setInterval(gameLoop, 150);
    }

    function drawSegment(seg, isHead=false) {
      ctx.fillStyle = isHead ? "green" : "lime";
      ctx.fillRect(seg.x, seg.y, 20, 20);
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      let head = {...snake[0]};
      if (direction === "RIGHT") head.x += 20;
      if (direction === "LEFT") head.x -= 20;
      if (direction === "UP") head.y -= 20;
      if (direction === "DOWN") head.y += 20;

      if (head.x < 0 || head.y < 0 || head.x >= 400 || head.y >= 400 || snake.some(s => s.x === head.x && s.y === head.y)) {
        lives--;
        document.getElementById("lives").innerText = lives;
        if (lives <= 0) {
          clearInterval(interval);
          music.pause();
          gameOverSound.play();
          saveResult();
          return;
        } else {
          snake = [{x: 200, y: 200}];
          direction = "RIGHT";
          return;
        }
      }

      snake.unshift(head);
      if (head.x === food.x && head.y === food.y) {
        score++;
        document.getElementById("score").innerText = score;
        eatSound.play();
        food = {x: Math.floor(Math.random()*20)*20, y: Math.floor(Math.random()*20)*20};
        checkAchievements();
      } else {
        snake.pop();
      }

      snake.forEach((s, i) => drawSegment(s, i === 0));
      ctx.fillStyle = "red";
      ctx.fillRect(food.x, food.y, 20, 20);
    }

    function checkAchievements() {
      const achList = document.getElementById("achList");
      achList.innerHTML = "";
      achievements = [];
      if (score >= 5) achievements.push("🥉 5 Punkte!");
      if (score >= 10) achievements.push("🥈 10 Punkte!");
      if (score >= 20) achievements.push("🥇 20 Punkte!");
      achievements.forEach(a => {
        const li = document.createElement("li");
        li.innerText = a;
        achList.appendChild(li);
      });
    }

    function saveResult() {
      leaderboard.push({name: playerName, score: score});
      leaderboard.sort((a, b) => b.score - a.score);
      leaderboard = leaderboard.slice(0, 10);
      localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
      document.getElementById("menu").style.display = "block";
      document.getElementById("game").style.display = "none";
      document.getElementById("info").style.display = "none";
      document.getElementById("touchControls").style.display = "none";
      showLeaderboard();
    }

    function showLeaderboard() {
      const scoreList = document.getElementById("scoreList");
      scoreList.innerHTML = "";
      leaderboard.forEach(entry => {
        const li = document.createElement("li");
        li.innerText = `${entry.name}: ${entry.score}`;
        scoreList.appendChild(li);
      });
      document.getElementById("leaderboard").style.display = "block";
      document.getElementById("achievements").style.display = "block";
    }

    function setDir(dir) {
      if ((dir === "LEFT" && direction !== "RIGHT") ||
          (dir === "RIGHT" && direction !== "LEFT") ||
          (dir === "UP" && direction !== "DOWN") ||
          (dir === "DOWN" && direction !== "UP")) {
        direction = dir;
      }
    }

    document.addEventListener("keydown", e => {
      if (e.key === "ArrowLeft") setDir("LEFT");
      if (e.key === "ArrowRight") setDir("RIGHT");
      if (e.key === "ArrowUp") setDir("UP");
      if (e.key === "ArrowDown") setDir("DOWN");
    });
  </script>
</body>
</html>
